# Arquivo: .github/workflows/deploy.yml
#
# Workflow para fazer o build do projeto e o deploy via FTP para a Locaweb
# a cada push na branch 'main'.

name: Deploy via FTP para Locaweb

on:
  # Executa em pushes para a branch principal
  push:
    branches: ['main']

  # Permite que você execute este workflow manualmente na aba Actions
  workflow_dispatch:

jobs:
  # Job de deploy
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      # 1. Faz o checkout do código do seu repositório
      - name: Checkout do código
        uses: actions/checkout@v4

      # 2. Configura o ambiente Node.js para o build
      - name: Configurar o Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # 3. Instala as dependências do projeto
      - name: Instalar dependências
        run: npm ci

      # 4. Executa o build (gerando a pasta 'out')
      - name: Build do projeto
        run: npm run build

      # 5. Envia os arquivos da pasta 'out' para o FTP
      - name: FTP Deploy Locaweb
        uses: locaweb/ftp-deploy@1.0.0
        with:
          host: ${{ secrets.HOST }}
          user: ${{ secrets.USER }}
          password: ${{ secrets.PASS }}
          localDir: "out"
          remoteDir: "/public_html/novositeteca/" # Pasta de destino no servidor